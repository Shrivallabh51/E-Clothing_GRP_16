package com.example.demo.services;

import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.example.demo.entities.Carts;
import com.example.demo.entities.CartsDto;
import com.example.demo.entities.CategoryDto;
import com.example.demo.entities.ProductDto;
import com.example.demo.entities.UserDto;
import com.example.demo.repositories.CartRepository;

@Service
public class CartService {
     @Autowired
     CartRepository crepo;
     
     public List<CartsDto> getCartsByUserId(int userId) {
    	 
         return crepo.findByUserId(userId).stream()
                 .map(this::convertToDto)
                 .collect(Collectors.toList());
     }

     private CartsDto convertToDto(Carts cart) {
         UserDto userDto = new UserDto();
         userDto.setUser_Id(cart.getUsers().getUser_Id());
         userDto.setUsername(cart.getUsers().getUsername());
         userDto.setMobile(cart.getUsers().getMobile());
         userDto.setEmail(cart.getUsers().getEmail());

         ProductDto productDto = new ProductDto();
         productDto.setP_id(cart.getProducts().getP_id());
         productDto.setProduct_Name(cart.getProducts().getProduct_Name());
         productDto.setDescription(cart.getProducts().getDescription());
         productDto.setPrice(cart.getProducts().getPrice());
         productDto.setStock_Qty(cart.getProducts().getStock_Qty());
         
         // Assuming CategoryDto and UserDto conversion methods are available
         CategoryDto categoryDto = new CategoryDto();
         categoryDto.setCat_id(cart.getProducts().getCategory().getCat_id());
         categoryDto.setCat_name(cart.getProducts().getCategory().getCat_name());
         
         
         productDto.setCategorydto(categoryDto);
         productDto.setUserdto(userDto); // Assuming the product's user is the same as the cart's user

         CartsDto cartsDto = new CartsDto();
         cartsDto.setCartId(cart.getCart_id());
         cartsDto.setStockQty(cart.getStock_Qty());
       
         cartsDto.setUserDto(userDto);
         cartsDto.setProductDto(productDto);

         return cartsDto;
     }
}
